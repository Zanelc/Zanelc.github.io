---
title: 程序员的自我修养--二
abbrlink: b884c480
date: 2023-08-17 00:40:41
categories:
  - [纸上得来终觉浅,程序员的自我修养--链接、装载与库]
tags:
  - 浅析程序运行原理
  - 程序链接过程
index_img: https://cdn.jsdelivr.net/gh/Zanelc/Zanelc.github.io@main/posts/b884c480/title.png
---

接上一篇文章的内容，接下来对程序的链接过程进行分析。

<!--more-->

**当我们有两个目标文件时，如何将他们链接起来形成一个可执行文件？这个过程中发生了什么？**

### 背景

使用以下两个源代码文件展开分析：

```c
// a.c
extern int shared;
extern void swap(int* a,int* b);
int main()
{
	int a=100;
	swap(&a,&shared);
}

// b.c
int shared=1;
void swap(int* a, int* b)
{
	int temp = *a;
    *a = *b;
    *b = temp;
}

$:gcc -c a.c b.c
```

### 空间与地址分配

**对于多个输入目标文件，链接器如何将他们的各个段合并到输出文件？**

#### 按序叠加

![按序叠加](E:\Zanelc_blog\source\_posts\程序员的自我修养-二\image-20230817013511092.png)

这并不是一个很好的方案，因为 **每个段都有一定的地址和空间对齐要求** ，在有很多输入文件的情况下，输出文件将会有很多零散的段，会造成大量的内存碎片。

#### 相似段合并

![相似段合并](E:\Zanelc_blog\source\_posts\程序员的自我修养-二\image-20230817013731658.png)

采用这种方法的链接器一般都采用一种叫 **两步链接** 的方法：

1. 空间与地址分配
2. 符号解析与重定位 **这一步是链接过程的核心，特别是重定位过程。**

