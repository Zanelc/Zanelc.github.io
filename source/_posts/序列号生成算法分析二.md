---
title: 序列号生成算法分析二
categories:
  - [使用Ollydbg从零开始Cracking,xdbg使用]
tags:
  - xdbg基础使用
  - 序列号算法分析
  - 菜鸡逆向
abbrlink: 4c519c4d
date: 2023-08-16 23:41:06
index_img: https://cdn.jsdelivr.net/gh/Zanelc/Zanelc.github.io@main/posts/4c519c4d/title.png
---

序列号生成算法分析--二
<!--more-->

### Mexcrk1

#### 程序分析

使用 **x32dbg** 加载程序，断在入口处。

![入口断点](https://cdn.jsdelivr.net/gh/Zanelc/Zanelc.github.io@main/posts/4c519c4d/image-20230820231927259.png)

查找 **字符串引用** ，可以看到以下字符串。

![字符串引用](https://cdn.jsdelivr.net/gh/Zanelc/Zanelc.github.io@main/posts/4c519c4d/image-20230820232037158.png)

双击跳转到字符串附近，发现 **call** 指令决定后面的 **je** 指令是跳转到 **Thanks you ...** 处还是 **Wrong Code DUDE** 处，在 **call指令** 之前设置断点并运行程序。

![跳转字符串附近](https://cdn.jsdelivr.net/gh/Zanelc/Zanelc.github.io@main/posts/4c519c4d/image-20230820232133913.png)

![输出序列号](https://cdn.jsdelivr.net/gh/Zanelc/Zanelc.github.io@main/posts/4c519c4d/image-20230820232413273.png)

跟进这个 **call** ，函数将我们输入的错误序列号与 **Benadry1** 进行比较。

![比较字符串](https://cdn.jsdelivr.net/gh/Zanelc/Zanelc.github.io@main/posts/4c519c4d/image-20230820233554751.png)

执行到返回，手动将 **ZF** 标志位置1，跳转到 **Thanks you ...** 出，继续运行程序，提示成功。

![提示成功](https://cdn.jsdelivr.net/gh/Zanelc/Zanelc.github.io@main/posts/4c519c4d/image-20230820233655627.png)

**注：** 此处有一个疑问，当查看API调用信息时，发现有导入 **GetWindowTextA** 函数，但是下断点后断不下来。

![API列表](https://cdn.jsdelivr.net/gh/Zanelc/Zanelc.github.io@main/posts/4c519c4d/image-20230820234727709.png)

### Canasta

#### 程序分析

**对这个程序的破解还不是很深入，只能实现破解，具体原理还不清楚。**

**xdbg**加载程序后， 打开注册页面，只有当用户输入的用户名和序列号组合正确时 **OK** 按钮才会变为可用。

![注册窗口](https://cdn.jsdelivr.net/gh/Zanelc/Zanelc.github.io@main/posts/4c519c4d/image-20230821000433769.png)

由于 **OK** 按钮不可用，所以不能通过单击 **OK** 按钮来获取错误提示是什么，输入 **用户名** ，接着输入序列号 **passwd**：

![输入序列号](https://cdn.jsdelivr.net/gh/Zanelc/Zanelc.github.io@main/posts/4c519c4d/image-20230827013027560.png)

此时在内存中查找我们输入的序列号，**内存布局--搜索匹配特征** 或使用快捷键 **ctrb+B**，输入要查找的字符串 **passwd**：

![搜索匹配特征](https://cdn.jsdelivr.net/gh/Zanelc/Zanelc.github.io@main/posts/4c519c4d/image-20230827013133367.png)

![查找字符串](https://cdn.jsdelivr.net/gh/Zanelc/Zanelc.github.io@main/posts/4c519c4d/image-20230827013254014.png)

根据查询结果，可以看到，**passwd** 在内存中有多次出现，可能是有些脏数据，为了避免被其他数据干扰，换一个特殊一些的字符串（当然也可以对搜索结果中的字符串进行筛选，找到我们输入字符串的内存地址），比如输入 **ILoveU**，再次搜索，只找到一处匹配，即为输入字符串的存储位置：

![输入序列号](https://cdn.jsdelivr.net/gh/Zanelc/Zanelc.github.io@main/posts/4c519c4d/image-20230827013910518.png)

![ILoveU](https://cdn.jsdelivr.net/gh/Zanelc/Zanelc.github.io@main/posts/4c519c4d/image-20230827013935748.png)

在 **02611CB9** 地址处下 **硬件断点(1字节)**，继续在序列号窗口后边输入字符，程序断下来，**F9** 继续运行程序，继续搜索 **ILoveU** 字符串，看程序是否把输入序列号复制到其他位置：

![查找特征值](https://cdn.jsdelivr.net/gh/Zanelc/Zanelc.github.io@main/posts/4c519c4d/image-20230827014409521.png)

发现，除了我们刚刚下断点的位置外，又有两处位置出现了 **ILoveU** 字符串，刚开始是没有的，说明程序运行过程中把输入的序列号复制到这里，对这两处地址下   **硬件断点**：

![断点](https://cdn.jsdelivr.net/gh/Zanelc/Zanelc.github.io@main/posts/4c519c4d/image-20230827014618181.png)

继续 **F9** 运行程序，由于访问 **0019DEA4** （下过硬件断点），程序断下来：

![程序中断](https://cdn.jsdelivr.net/gh/Zanelc/Zanelc.github.io@main/posts/4c519c4d/image-20230827014845972.png)

发现 **CMP** 比较指令，查看两处比较内容， **EAX** 处存储输入的字符串 **ILoveU** ，**EDX** 处存储字符串 **133782**，猜测序列号可能是这个：

![EAX](https://cdn.jsdelivr.net/gh/Zanelc/Zanelc.github.io@main/posts/4c519c4d/image-20230827014943217.png)

![EDX](https://cdn.jsdelivr.net/gh/Zanelc/Zanelc.github.io@main/posts/4c519c4d/image-20230827015053275.png)

清除所有硬件断点，在序列号输入框输入 **133782** ，**OK** 按钮可以点击！，破解成功！

![OK](https://cdn.jsdelivr.net/gh/Zanelc/Zanelc.github.io@main/posts/4c519c4d/image-20230827015227119.png)

![Success!](https://cdn.jsdelivr.net/gh/Zanelc/Zanelc.github.io@main/posts/4c519c4d/image-20230827015343340.png)

**水平有限，整体过程有些牵强，每次输入不同的名称，序列号数字都在变化，这里省略了对生成序列号部分的分析，也没有解释为什么这个比较指令处就是比较序列号。**
